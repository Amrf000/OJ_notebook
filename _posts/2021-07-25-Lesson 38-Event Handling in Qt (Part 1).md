---
layout: post
title: Lesson 38-Event Handling in Qt (Part 1)
category: qt5
tags: [qt5]
---
1. GUI program principle review
Message processing model for graphical interface applications
![](/md_blog/public/assets/2021-07-25/42f265c109c557289f3d1ac54b391e6d.png)
2. Thinking
Sent by the operating systemNewsHow to turn intoQt signal？ 
3. Event processing in Qt
Qt platform converts messages generated by the system into Qt events
Qt incident is aQEventObject
Qt events are used forDescribe the actions that occur inside or outside the program
- ArbitraryQObjectObjects have the ability to handle events
![](/md_blog/public/assets/2021-07-25/2b09e291c1ec67a8f6fadec84e7fa8f4.png)
Event processing method of GUI application
1. After the Qt incident occurred, it was immediatelyDistribute to QWdget object
2. QWidgetmiddleevent(QEvent\*)Perform event processing
3. event()According to event typeCall different event processing functions
4. In the event handler functionSend predefined signals in Qt
5. Call the slot function associated with the signal
Scenario analysis: button click
![](/md_blog/public/assets/2021-07-25/070dbcf53dfcae75130125f95c269fd7.png)
QPushButton event processing analysis
1. Received mouse events
2. Call event(QEvent\*) Member functions
3. Call mouseReleaseEvent(QMouseEvent\*) Member functions
4. Callclick()Member function
5. Trigger signalSIGNAL(clicked()) 
4. Programming experiment
Custom event processing function 38-1.pro
QMyPushButton.h
```
#ifndef _QMYPUSHBUTTON_H_
#define _QMYPUSHBUTTON_H_

#include <QPushButton>

typedef void(QButtonListener)(QObject *, QMouseEvent *);

class QMyPushButton : public QPushButton {
  Q_OBJECT
protected:
  QButtonListener *m_listener;

  void mouseReleaseEvent(QMouseEvent *e);

public:
  explicit QMyPushButton(QWidget *parent = 0, QButtonListener *listener = 0);

signals:

public slots:
};

#endif // _QMYPUSHBUTTON_H_
```
QMyPushButton.cpp
```
#include "QMyPushButton.h"
#include <QMouseEvent>

QMyPushButton::QMyPushButton(QWidget *parent, QButtonListener *listener)
    : QPushButton(parent) {
  m_listener = listener;
}

void QMyPushButton::mouseReleaseEvent(
    QMouseEvent *e) // Rewrite the event handler function, it will be called
                    // after the event is assigned
{
  if (m_listener != NULL) {
    m_listener(this, e); // Call the function onMyButtonMouseRelease pointed to
                         // by the member pointer, there is no predefined signal

    e->accept(); // Mark the current event has been processed

    setDown(false); // Update the UI, the button pops up
  } else {
    QPushButton::mouseReleaseEvent(e);
  }
}
```
Widget.h
```
#ifndef _WIDGET_H_
#define _WIDGET_H_

#include "QMyPushButton.h"
#include <QtGui/QWidget>

class Widget : public QWidget {
  Q_OBJECT

  QMyPushButton myButton;
protected slots:
  void onMyButtonClicked();

public:
  Widget(QWidget *parent = 0);
  ~Widget();
};

#endif // _WIDGET_H_
```
Widget.cpp
```
#include "Widget.h"
#include <QDebug>

void onMyButtonMouseRelease(QObject *sender, QMouseEvent *e) {
  qDebug() << "onMyButtonMouseRelease(QObject* sender, QMouseEvent* e)";
}

Widget::Widget(QWidget *parent)
    : QWidget(parent), myButton(this, onMyButtonMouseRelease) {
  myButton.setText("QMyPushButton");

  connect(&myButton, SIGNAL(clicked()), this, SLOT(onMyButtonClicked()));
}

void Widget::onMyButtonClicked() { qDebug() << "onMyButtonClicked()"; }

Widget::~Widget() {}
```
main.cpp
```
#include "Widget.h"
#include <QtGui/QApplication>

int main(int argc, char *argv[]) {
  QApplication a(argc, argv);
  Widget w;
  w.show();

  return a.exec();
}
```
5. Event processing in Qt
event(QEvent) And signal (SIGNAL)different
-Events are handled by specific objects
-Signals are actively generated by specific objects
------ Rewriting the event processing function may cause the program behavior to change
-Whether the corresponding slot function of the signal does not change the program behavior
－Generally speaking, signals are generated in specific event processing functions
6. Close operation in the text editor
![](/md_blog/public/assets/2021-07-25/9236dffa44932a0074639e6b413af787.png)
7. Programming experiment
Close operation of the text editor NotePad.pro
Found that there is no signal in QMainWindow and QWidget to solve the current problem
Consider rewriting event handler function
Found void Widget::closeEvent(QcloseEvent* event)
New in MainWindow.h
```
protected:
void closeEvent(QCloseEvent *e);
```
New in MainWindowSlots.cpp
```
void MainWindow::closeEvent(QCloseEvent *e) {
  preEditorChange(); // Confirm whether to save

  if (!m_isTextChanged) {
    QMainWindow::closeEvent(e);
  } else {
    e->ignore();
  }
}
```
8. Summary
Events in Qt (QEvent) And signal (SIGNAL)Different
Events are handled by QObject objects
The signal is triggered by the QObject object
Rewriting event handler functions may change program behavior
The trigger of the signal will not affect the behavior of the program
Event processing is very common in practical engineering development
