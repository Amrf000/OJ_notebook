---
layout: post
title: Lesson 38-Event Handling in Qt (Part 1)
category: qt5
tags: [qt5]
---
# 

## 

##### 

### 

1\. GUI program principle review

Message processing model for graphical interface applications

![](/public/assets/2021-07-25/42f265c109c557289f3d1ac54b391e6d.png)

2\. Thinking

Sent by the operating systemNewsHow to turn intoQt signal？ 

3\. Event processing in Qt

Qt platform converts messages generated by the system into Qt events

Qt incident is aQEventObject

Qt events are used forDescribe the actions that occur inside or outside the program

- ArbitraryQObjectObjects have the ability to handle events

![](/public/assets/2021-07-25/2b09e291c1ec67a8f6fadec84e7fa8f4.png)

Event processing method of GUI application

1\. After the Qt incident occurred, it was immediatelyDistribute to QWdget object

2\. QWidgetmiddleevent(QEvent\*)Perform event processing

3\. event()According to event typeCall different event processing functions

4\. In the event handler functionSend predefined signals in Qt

5\. Call the slot function associated with the signal

Scenario analysis: button click

![](/public/assets/2021-07-25/070dbcf53dfcae75130125f95c269fd7.png)

QPushButton event processing analysis

1\. Received mouse events

2\. Call event(QEvent\*) Member functions

3\. Call mouseReleaseEvent(QMouseEvent\*) Member functions

4\. Callclick()Member function

5\. Trigger signalSIGNAL(clicked()) 

4\. Programming experiment

Custom event processing function 38-1.pro

QMyPushButton.h
    

1. #ifndef _QMYPUSHBUTTON_H_
    

2. #define _QMYPUSHBUTTON_H_
    

3. 4. #include <QPushButton>
    

5. 6. typedef void (QButtonListener)(QObject*, QMouseEvent*);
    

7. 8. class QMyPushButton : public QPushButton
    

9. {
    

10.  Q_OBJECT
    

11. protected:
    

12.  QButtonListener* m_listener;
    

13. 14.  void mouseReleaseEvent(QMouseEvent *e);
    

15. public:
    

16.  explicit QMyPushButton(QWidget* parent = 0, QButtonListener* listener = 0);
    

17. 18. signals:
    

19. 20. public slots:
    

21. 22. };
    

23. 24. #endif // _QMYPUSHBUTTON_H_
    
    

QMyPushButton.cpp
    

1. #include "QMyPushButton.h"
    

2. #include <QMouseEvent>
    

3. 4. QMyPushButton::QMyPushButton(QWidget* parent, QButtonListener* listener) : QPushButton(parent)
    

5. {
    

6.  m_listener = listener;
    

7. }
    

8. 9.  void QMyPushButton::mouseReleaseEvent(QMouseEvent *e) //Rewrite the event handler function, it will be called after the event is assigned 
    

10. {
    

11.  if( m_listener != NULL )
    

12.  {
    

13.  m_listener(this, e);//Call the function onMyButtonMouseRelease pointed to by the member pointer, there is no predefined signal
    

14. 15.  e->accept();//Mark the current event has been processed
    

16. 17.  setDown(false);//Update the UI, the button pops up
    

18.  }
    

19.  else
    

20.  {
    

21.  QPushButton::mouseReleaseEvent(e);
    

22.  }
    

23. }
    

24. 

Widget.h
    

1. #ifndef _WIDGET_H_
    

2. #define _WIDGET_H_
    

3. 4. #include <QtGui/QWidget>
    

5. #include "QMyPushButton.h"
    

6. 7. class Widget : public QWidget
    

8. {
    

9.  Q_OBJECT
    

10. 11.  QMyPushButton myButton;
    

12. protected slots:
    

13.  void onMyButtonClicked();
    

14. public:
    

15.  Widget(QWidget *parent = 0);
    

16.  ~Widget();
    

17. };
    

18. 19. #endif // _WIDGET_H_
    
    

Widget.cpp
    

1. #include "Widget.h"
    

2. #include <QDebug>
    

3. 4. void onMyButtonMouseRelease(QObject* sender, QMouseEvent* e)
    

5. {
    

6.  qDebug() << "onMyButtonMouseRelease(QObject* sender, QMouseEvent* e)";
    

7. }
    

8. 9. Widget::Widget(QWidget *parent) : QWidget(parent), myButton(this, onMyButtonMouseRelease)
    

10. {
    

11.  myButton.setText("QMyPushButton");
    

12. 13.  connect(&myButton, SIGNAL(clicked()), this, SLOT(onMyButtonClicked()));
    

14. }
    

15. 16. void Widget::onMyButtonClicked()
    

17. {
    

18.  qDebug() << "onMyButtonClicked()";
    

19. }
    

20. 21. 22. Widget::~Widget()
    

23. {
    

24. 25. }
    
    

main.cpp
    

1. #include <QtGui/QApplication>
    

2. #include "Widget.h"
    

3. 4. int main(int argc, char *argv[])
    

5. {
    

6.  QApplication a(argc, argv);
    

7.  Widget w;
    

8.  w.show();
    

9. 10.  return a.exec();
    

11. }
    
    

5\. Event processing in Qt

event(QEvent) And signal (SIGNAL)different

-Events are handled by specific objects

-Signals are actively generated by specific objects

------ Rewriting the event processing function may cause the program behavior to change

-Whether the corresponding slot function of the signal does not change the program behavior

－Generally speaking, signals are generated in specific event processing functions

6\. Close operation in the text editor

![](/public/assets/2021-07-25/9236dffa44932a0074639e6b413af787.png)

7\. Programming experiment

Close operation of the text editor NotePad.pro

Found that there is no signal in QMainWindow and QWidget to solve the current problem

Consider rewriting event handler function

Found void Widget::closeEvent(QcloseEvent\* event)

New in MainWindow.h
    

1. protected:
    

2.  void closeEvent(QCloseEvent* e);
    
    

New in MainWindowSlots.cpp
    

1. void MainWindow::closeEvent(QCloseEvent* e)
    

2. {
    

3.  preEditorChange();//Confirm whether to save
    

4. 5.  if( !m_isTextChanged )
    

6.  {
    

7.  QMainWindow::closeEvent(e);
    

8.  }
    

9.  else
    

10.  {
    

11.  e->ignore();
    

12.  }
    

13. }
    
    

8\. Summary

Events in Qt (QEvent) And signal (SIGNAL)Different

Events are handled by QObject objects

The signal is triggered by the QObject object

Rewriting event handler functions may change program behavior

The trigger of the signal will not affect the behavior of the program

Event processing is very common in practical engineering development