---
layout: post
title: Lesson 10-Explore message processing in Qt
category: qt5
tags: [qt5]
---
1. Qt message model
Qt encapsulates the message mechanism of specific operating systems
Qt follows the classic GUI message-driven event model
![](/md_blog/public/assets/2021-07-25/8315335e3e268047d72cf150ca1f5a7b.png)
2. Thinking
In Qt ChinaHow to represent user messages? A
In Qt ChinaHow to map user messages to message processing functions? AIn Qt ChinaWhat are the rules for message mapping? A
3. Signals and slots
Qt defines concepts related to system messages
－Signal
............ Messages generated by the operating system
-Slot
............ Message processing function in the program
------Connect
............ Bind system messages to message processing functions
Message processing mechanism in Qt
![](/md_blog/public/assets/2021-07-25/ce1fae850a34599e7a3fbcf40a079236.png)
The connection of the signal to the slot must occur between two Qt class objects! A
The core of Qt-QObject::connectFunction
![](/md_blog/public/assets/2021-07-25/f301aa33206c82f892f1fe8b37c4daf5.png)
- Note: 
In Qt, the message is used in QtStringDescribe
• The connect function is inMessage namewithHandler functionbetweenEstablish mapping
"New" keywords in Qt
- SIGNAL (Macro)
. Used to specifyMessage name
- SLOT 
. ForSpecify the message processing function name
- Q\_OBJECT . All custom slot classesQ\_OBJECT must be added at the beginning of the class declaration  
- slots . Used in classDeclare the message processing function  
4. Programming experiment
Probe into signals and slots 10-1.pro
```
#include <QPushButton>
#include <QtGui/QApplication>

int main(int argc, char *argv[]) {
  QApplication a(argc, argv);
  QPushButton b; // Become the top-level window

  b.setText("Click me to quit!");

  b.show();

  QObject::connect(&b, SIGNAL(clicked()), &a, SLOT(quit()));

  // Map the click message of the button object to the quit function of the a
  // object

  return a.exec();
}
```
![](/md_blog/public/assets/2021-07-25/18ecc2a12547c80c60dd350cac4ee985.png)
5. Custom slot
OnlyQObjectSub-categoryCustom slot
The class that defines the slot must be inUse Q\_OBJECT at the beginning of the declaration
In the categoryDeclaration slotNeed to useslotsKeywords
The function signature of the slot and the processed signal must be consistent
Among the names specified by SIGNAL and SLOT:
－Can contain parameter types•-Cannot contain specific parameter names
6. Programming experimentAdd a message processing function for the calculator instance
QCalculatorUI.h
```
#ifndef _QCALCULATORUI_H_
#define _QCALCULATORUI_H_

#include <QLineEdit>
#include <QPushButton>
#include <QWidget>

class QCalculatorUI : public QWidget {
  Q_OBJECT
private:
  QLineEdit *m_edit;
  QPushButton *m_buttons[20];

  QCalculatorUI();
  bool construct();
private slots:
  void onButtonClicked();

public:
  static QCalculatorUI *NewInstance();
  void show();
  ~QCalculatorUI();
};

#endif
```
QCalculatorUI.cpp
```
#include "QCalculatorUI.h"
#include <QDebug>

QCalculatorUI::QCalculatorUI() : QWidget(NULL, Qt::WindowCloseButtonHint) {}

bool QCalculatorUI::construct() {
  bool ret = true;
  const char *btnText[20] = {
      "7", "8", "9", "+", "(",  "4", "5", "6", "-", ")",
      "1", "2", "3", "*", "<-", "0", ".", "=", "/", "C",
  };

  m_edit = new QLineEdit(this);

  if (m_edit != NULL) {
    m_edit->move(10, 10);
    m_edit->resize(240, 30);
    m_edit->setReadOnly(true);
  } else {
    ret = false;
  }

  for (int i = 0; (i < 4) && ret; i++) {
    for (int j = 0; (j < 5) && ret; j++) {
      m_buttons[i * 5 + j] = new QPushButton(this);

      if (m_buttons[i * 5 + j] != NULL) {
        m_buttons[i * 5 + j]->resize(40, 40);
        m_buttons[i * 5 + j]->move(10 + (10 + 40) * j, 50 + (10 + 40) * i);
        m_buttons[i * 5 + j]->setText(btnText[i * 5 + j]);

        connect(m_buttons[i * 5 + j], SIGNAL(clicked()), this,
                SLOT(onButtonClicked()));
      } else {
        ret = false;
      }
    }
  }

  return ret;
}

QCalculatorUI *QCalculatorUI::NewInstance() {
  QCalculatorUI *ret = new QCalculatorUI();

  if ((ret == NULL) || !ret->construct()) {
    delete ret;
    ret = NULL;
  }

  return ret;
}

void QCalculatorUI::show() {
  QWidget::show();

  setFixedSize(width(), height());
}

void QCalculatorUI::onButtonClicked() {
  QPushButton *btn =
      (QPushButton *)sender(); // Returns the connection that sent the signal
                               // returns the clicked button pointer

  qDebug() << "onButtonClicked()";
  qDebug() << btn->text();
}

QCalculatorUI::~QCalculatorUI() {}
```
main.cpp
```
#include "QCalculatorUI.h"
#include <QtGui/QApplication>

int main(int argc, char *argv[]) {
  QApplication a(argc, argv);
  QCalculatorUI *cal = QCalculatorUI::NewInstance();
  int ret = -1;

  if (cal != NULL) {
    cal->show();

    ret = a.exec();

    delete cal;
  }

  return ret;
}
```
![](/md_blog/public/assets/2021-07-25/41ea845ef0dea010be13f3206fd71350.png)  
7. Tips
Solve classic problems:Object::connect: No such slot... 、
1. Check if the class inherits from QObject
2. Check whether Q\_OB ECT is added at the beginning of the class declaration
3. Check whether the slot keyword is used for slot declaration,
4. Check if the name of the slot is misspelled
5. Re-execute qmake
For more details, see the following text for more details
8. Summary
Signals and slots are the core mechanism in Qt
Different Qt objects can communicate through signals and slots
Only subclasses of QObject can customize signals and slots
Classes that use signals and slots must use Q_OBJECT at the beginning of the declaration
The signal and the processing function must be consistent on the function signature
